<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1761px" preserveAspectRatio="none" style="width:728px;height:1761px;" version="1.1" viewBox="0 0 728 1761" width="728px" zoomAndPan="magnify"><defs><filter height="300%" id="fs3ucbyyghzht" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53" y="120.5625"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="86.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53" y="603.2891"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53" y="913.1563"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="1622.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="190" y="50.2969"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="227.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="195" y="258.0938"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="211.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="195" y="1050.6875"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="111.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="195" y="1442.6875"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="1640.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="446" y="50.2969"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="140.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="451" y="157.6953"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="113.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="451" y="640.4219"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="140.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="451" y="950.2891"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="111.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="451" y="1222.3516"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="140.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="451" y="1484.8203"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="656" y="334.3594"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="656" y="421.7578"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="656" y="790.0859"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="656" y="1126.9531"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="468.7266" style="stroke:#000000;stroke-width:2.0;" width="704.5" x="10" y="57.2969"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="1125.3281" style="stroke:#000000;stroke-width:2.0;" width="711.5" x="3" y="540.0234"/><rect fill="#FFFFFF" height="521.5313" style="stroke:none;stroke-width:1.0;" width="711.5" x="3" y="852.2188"/><rect fill="#FFFFFF" height="291.6016" style="stroke:none;stroke-width:1.0;" width="711.5" x="3" y="1373.75"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="58" x2="58" y1="40.2969" y2="1718.3516"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="194.5" x2="194.5" y1="40.2969" y2="1718.3516"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="450.5" x2="450.5" y1="40.2969" y2="1718.3516"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="660.5" x2="660.5" y1="40.2969" y2="1718.3516"/><path d="M25,14 L91,14 C96,14 96,27.1484 96,27.1484 C96,27.1484 96,40.2969 91,40.2969 L25,40.2969 C20,40.2969 20,27.1484 20,27.1484 C20,27.1484 20,14 25,14 " fill="#FEFECE" filter="url(#fs3ucbyyghzht)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M91,14 C86,14 86,27.1484 86,27.1484 C86,40.2969 91,40.2969 91,40.2969 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="25" y="31.9951">Pipe (in)</text><path d="M25,1717.3516 L91,1717.3516 C96,1717.3516 96,1730.5 96,1730.5 C96,1730.5 96,1743.6484 91,1743.6484 L25,1743.6484 C20,1743.6484 20,1730.5 20,1730.5 C20,1730.5 20,1717.3516 25,1717.3516 " fill="#FEFECE" filter="url(#fs3ucbyyghzht)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M91,1717.3516 C86,1717.3516 86,1730.5 86,1730.5 C86,1743.6484 91,1743.6484 91,1743.6484 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="25" y="1735.3467">Pipe (in)</text><rect fill="#FEFECE" filter="url(#fs3ucbyyghzht)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="63" x="161.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="168.5" y="24.9951">Source</text><rect fill="#FEFECE" filter="url(#fs3ucbyyghzht)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="63" x="161.5" y="1717.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="168.5" y="1737.3467">Source</text><rect fill="#FEFECE" filter="url(#fs3ucbyyghzht)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="43" x="427.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="434.5" y="24.9951">Sink</text><rect fill="#FEFECE" filter="url(#fs3ucbyyghzht)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="43" x="427.5" y="1717.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="434.5" y="1737.3467">Sink</text><path d="M622.5,14 L699.5,14 C704.5,14 704.5,27.1484 704.5,27.1484 C704.5,27.1484 704.5,40.2969 699.5,40.2969 L622.5,40.2969 C617.5,40.2969 617.5,27.1484 617.5,27.1484 C617.5,27.1484 617.5,14 622.5,14 " fill="#FEFECE" filter="url(#fs3ucbyyghzht)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M699.5,14 C694.5,14 694.5,27.1484 694.5,27.1484 C694.5,40.2969 699.5,40.2969 699.5,40.2969 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="622.5" y="31.9951">Pipe (out)</text><path d="M622.5,1717.3516 L699.5,1717.3516 C704.5,1717.3516 704.5,1730.5 704.5,1730.5 C704.5,1730.5 704.5,1743.6484 699.5,1743.6484 L622.5,1743.6484 C617.5,1743.6484 617.5,1730.5 617.5,1730.5 C617.5,1730.5 617.5,1717.3516 622.5,1717.3516 " fill="#FEFECE" filter="url(#fs3ucbyyghzht)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M699.5,1717.3516 C694.5,1717.3516 694.5,1730.5 694.5,1730.5 C694.5,1743.6484 699.5,1743.6484 699.5,1743.6484 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="622.5" y="1735.3467">Pipe (out)</text><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53" y="120.5625"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="86.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53" y="603.2891"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="71.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53" y="913.1563"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="1622.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="190" y="50.2969"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="227.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="195" y="258.0938"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="211.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="195" y="1050.6875"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="111.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="195" y="1442.6875"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="1640.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="446" y="50.2969"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="140.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="451" y="157.6953"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="113.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="451" y="640.4219"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="140.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="451" y="950.2891"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="111.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="451" y="1222.3516"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="140.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="451" y="1484.8203"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="656" y="334.3594"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="656" y="421.7578"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="656" y="790.0859"/><rect fill="#FFFFFF" filter="url(#fs3ucbyyghzht)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="656" y="1126.9531"/><path d="M10,57.2969 L87,57.2969 L87,64.2969 L77,74.2969 L10,74.2969 L10,57.2969 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="468.7266" style="stroke:#000000;stroke-width:2.0;" width="704.5" x="10" y="57.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="25" y="70.3638">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="160" x="102" y="69.5073">[Pipe (in/out) not closed]</text><polygon fill="#A80036" points="74,116.5625,64,120.5625,74,124.5625,70,120.5625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="68" x2="189" y1="120.5625" y2="120.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="80" y="115.4966">read()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="456" x2="503" y1="144.6953" y2="144.6953"/><line style="stroke:#A80036;stroke-width:1.0;" x1="503" x2="503" y1="144.6953" y2="157.6953"/><line style="stroke:#A80036;stroke-width:1.0;" x1="462" x2="503" y1="157.6953" y2="157.6953"/><polygon fill="#A80036" points="472,153.6953,462,157.6953,472,161.6953,468,157.6953" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="468" y="139.6294">recv()</text><polygon fill="#A80036" points="178,187.8281,188,191.8281,178,195.8281,182,191.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58" x2="184" y1="191.8281" y2="191.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="65" y="186.7622">non-empty data</text><line style="stroke:#A80036;stroke-width:1.0;" x1="449" x2="439" y1="220.9609" y2="216.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="449" x2="439" y1="220.9609" y2="224.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="200" x2="450" y1="220.9609" y2="220.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="207" y="215.895">send(SourecAction::Data)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="200" x2="247" y1="245.0938" y2="245.0938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="247" x2="247" y1="245.0938" y2="258.0938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="206" x2="247" y1="258.0938" y2="258.0938"/><polygon fill="#A80036" points="216,254.0938,206,258.0938,216,262.0938,212,258.0938" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="212" y="240.0278">recv()</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="461" x2="503" y1="297.2266" y2="297.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="503" x2="503" y1="297.2266" y2="310.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="456" x2="503" y1="310.2266" y2="310.2266"/><polygon fill="#A80036" points="466,306.2266,456,310.2266,466,314.2266,462,310.2266" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="468" y="292.1606">SourceAction::Data</text><polygon fill="#A80036" points="644,330.3594,654,334.3594,644,338.3594,648,334.3594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="456" x2="650" y1="334.3594" y2="334.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="463" y="329.2935">write_all()</text><polygon fill="#A80036" points="467,359.4922,457,363.4922,467,367.4922,463,363.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="461" x2="660" y1="363.4922" y2="363.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="473" y="358.4263">Ok(())</text><line style="stroke:#A80036;stroke-width:1.0;" x1="205" x2="215" y1="392.625" y2="388.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="205" x2="215" y1="392.625" y2="396.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="205" x2="445" y1="392.625" y2="392.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="222" y="387.5591">send(SinkAction::Ack)</text><polygon fill="#A80036" points="644,417.7578,654,421.7578,644,425.7578,648,421.7578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="456" x2="650" y1="421.7578" y2="421.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="463" y="416.6919">flush()</text><polygon fill="#A80036" points="467,446.8906,457,450.8906,467,454.8906,463,450.8906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="461" x2="660" y1="450.8906" y2="450.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="473" y="445.8247">Ok(())</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="205" x2="247" y1="485.0234" y2="485.0234"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="247" x2="247" y1="485.0234" y2="498.0234"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="200" x2="247" y1="498.0234" y2="498.0234"/><polygon fill="#A80036" points="210,494.0234,200,498.0234,210,502.0234,206,498.0234" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="212" y="479.9575">SinkAction::Ack</text><path d="M3,540.0234 L67,540.0234 L67,547.0234 L57,557.0234 L3,557.0234 L3,540.0234 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="1125.3281" style="stroke:#000000;stroke-width:2.0;" width="711.5" x="3" y="540.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="18" y="553.0903">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="110" x="82" y="552.2339">[Pipe (in) closed]</text><polygon fill="#A80036" points="74,599.2891,64,603.2891,74,607.2891,70,603.2891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="68" x2="189" y1="603.2891" y2="603.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="80" y="598.2231">read()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="456" x2="503" y1="627.4219" y2="627.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="503" x2="503" y1="627.4219" y2="640.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="462" x2="503" y1="640.4219" y2="640.4219"/><polygon fill="#A80036" points="472,636.4219,462,640.4219,472,644.4219,468,640.4219" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="468" y="622.356">recv()</text><polygon fill="#A80036" points="178,685.6875,188,689.6875,178,693.6875,182,689.6875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58" x2="184" y1="689.6875" y2="689.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="65" y="669.4888">empty data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="65" y="684.6216">(pipe closed)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="449" x2="439" y1="718.8203" y2="714.8203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="449" x2="439" y1="718.8203" y2="722.8203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="200" x2="450" y1="718.8203" y2="718.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="207" y="713.7544">send(SourceAction::SourceClosed)</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="461" x2="503" y1="752.9531" y2="752.9531"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="503" x2="503" y1="752.9531" y2="765.9531"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="456" x2="503" y1="765.9531" y2="765.9531"/><polygon fill="#A80036" points="466,761.9531,456,765.9531,466,769.9531,462,765.9531" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="468" y="747.8872">SourceAction::SourceClosed</text><polygon fill="#A80036" points="644,786.0859,654,790.0859,644,794.0859,648,790.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="456" x2="650" y1="790.0859" y2="790.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="463" y="785.02">shutdown()</text><polygon fill="#A80036" points="467,815.2188,457,819.2188,467,823.2188,463,819.2188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="461" x2="660" y1="819.2188" y2="819.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="473" y="814.1528">Ok(())</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="3" x2="714.5" y1="853.2188" y2="853.2188"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="190" x="8" y="863.4292">[Read after Pipe (out) closed]</text><polygon fill="#A80036" points="74,909.1563,64,913.1563,74,917.1563,70,913.1563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="68" x2="189" y1="913.1563" y2="913.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="80" y="908.0903">read()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="456" x2="503" y1="937.2891" y2="937.2891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="503" x2="503" y1="937.2891" y2="950.2891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="462" x2="503" y1="950.2891" y2="950.2891"/><polygon fill="#A80036" points="472,946.2891,462,950.2891,472,954.2891,468,950.2891" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="468" y="932.2231">recv()</text><polygon fill="#A80036" points="178,980.4219,188,984.4219,178,988.4219,182,984.4219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58" x2="184" y1="984.4219" y2="984.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="65" y="979.356">non-empty data</text><line style="stroke:#A80036;stroke-width:1.0;" x1="449" x2="439" y1="1013.5547" y2="1009.5547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="449" x2="439" y1="1013.5547" y2="1017.5547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="200" x2="450" y1="1013.5547" y2="1013.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="207" y="1008.4888">send(SourecAction::Data)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="200" x2="247" y1="1037.6875" y2="1037.6875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="247" x2="247" y1="1037.6875" y2="1050.6875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="206" x2="247" y1="1050.6875" y2="1050.6875"/><polygon fill="#A80036" points="216,1046.6875,206,1050.6875,216,1054.6875,212,1050.6875" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="212" y="1032.6216">recv()</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="461" x2="503" y1="1089.8203" y2="1089.8203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="503" x2="503" y1="1089.8203" y2="1102.8203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="456" x2="503" y1="1102.8203" y2="1102.8203"/><polygon fill="#A80036" points="466,1098.8203,456,1102.8203,466,1106.8203,462,1102.8203" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="468" y="1084.7544">SourceAction::Data</text><polygon fill="#A80036" points="644,1122.9531,654,1126.9531,644,1130.9531,648,1126.9531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="456" x2="650" y1="1126.9531" y2="1126.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="463" y="1121.8872">write_all()</text><polygon fill="#A80036" points="467,1152.0859,457,1156.0859,467,1160.0859,463,1156.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="461" x2="660" y1="1156.0859" y2="1156.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="473" y="1151.02">Err(BrokenPipe)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="205" x2="215" y1="1185.2188" y2="1181.2188"/><line style="stroke:#A80036;stroke-width:1.0;" x1="205" x2="215" y1="1185.2188" y2="1189.2188"/><line style="stroke:#A80036;stroke-width:1.0;" x1="205" x2="445" y1="1185.2188" y2="1185.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="222" y="1180.1528">SinkAction::SinkClosed</text><line style="stroke:#A80036;stroke-width:1.0;" x1="456" x2="503" y1="1209.3516" y2="1209.3516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="503" x2="503" y1="1209.3516" y2="1222.3516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="462" x2="503" y1="1222.3516" y2="1222.3516"/><polygon fill="#A80036" points="472,1218.3516,462,1222.3516,472,1226.3516,468,1222.3516" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="468" y="1204.2856">recv()</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="205" x2="247" y1="1261.4844" y2="1261.4844"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="247" x2="247" y1="1261.4844" y2="1274.4844"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="200" x2="247" y1="1274.4844" y2="1274.4844"/><polygon fill="#A80036" points="210,1270.4844,200,1274.4844,210,1278.4844,206,1274.4844" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="212" y="1256.4185">SinkAction::SinkClosed</text><line style="stroke:#A80036;stroke-width:1.0;" x1="449" x2="439" y1="1298.6172" y2="1294.6172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="449" x2="439" y1="1298.6172" y2="1302.6172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="200" x2="450" y1="1298.6172" y2="1298.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="207" y="1293.5513">SourceAction::SourceClosed</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="461" x2="503" y1="1332.75" y2="1332.75"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="503" x2="503" y1="1332.75" y2="1345.75"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="456" x2="503" y1="1345.75" y2="1345.75"/><polygon fill="#A80036" points="466,1341.75,456,1345.75,466,1349.75,462,1345.75" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="468" y="1327.6841">SourceAction::SourceClosed</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="3" x2="714.5" y1="1374.75" y2="1374.75"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="327" x="8" y="1384.9604">[Pipe (out) closed, but no read operation occurred]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="200" x2="247" y1="1429.6875" y2="1429.6875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="247" x2="247" y1="1429.6875" y2="1442.6875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="206" x2="247" y1="1442.6875" y2="1442.6875"/><polygon fill="#A80036" points="216,1438.6875,206,1442.6875,216,1446.6875,212,1442.6875" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="212" y="1424.6216">recv()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="456" x2="503" y1="1471.8203" y2="1471.8203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="503" x2="503" y1="1471.8203" y2="1484.8203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="462" x2="503" y1="1484.8203" y2="1484.8203"/><polygon fill="#A80036" points="472,1480.8203,462,1484.8203,472,1488.8203,468,1484.8203" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="468" y="1466.7544">recv()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="188" x2="178" y1="1518.9531" y2="1514.9531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="188" x2="178" y1="1518.9531" y2="1522.9531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="0" x2="189" y1="1518.9531" y2="1518.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="7" y="1513.8872">SinkAction::SinkClosed</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="205" x2="247" y1="1553.0859" y2="1553.0859"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="247" x2="247" y1="1553.0859" y2="1566.0859"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="200" x2="247" y1="1566.0859" y2="1566.0859"/><polygon fill="#A80036" points="210,1562.0859,200,1566.0859,210,1570.0859,206,1566.0859" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="212" y="1548.02">SinkAction::SinkClosed</text><line style="stroke:#A80036;stroke-width:1.0;" x1="449" x2="439" y1="1590.2188" y2="1586.2188"/><line style="stroke:#A80036;stroke-width:1.0;" x1="449" x2="439" y1="1590.2188" y2="1594.2188"/><line style="stroke:#A80036;stroke-width:1.0;" x1="200" x2="450" y1="1590.2188" y2="1590.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="207" y="1585.1528">SourceAction::SourceClosed</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="461" x2="503" y1="1624.3516" y2="1624.3516"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="503" x2="503" y1="1624.3516" y2="1637.3516"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="456" x2="503" y1="1637.3516" y2="1637.3516"/><polygon fill="#A80036" points="466,1633.3516,456,1637.3516,466,1641.3516,462,1637.3516" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="468" y="1619.2856">SourceAction::SourceClosed</text><line style="stroke:#A80036;stroke-width:2.0;" x1="186" x2="204" y1="1672.3516" y2="1690.3516"/><line style="stroke:#A80036;stroke-width:2.0;" x1="186" x2="204" y1="1690.3516" y2="1672.3516"/><line style="stroke:#A80036;stroke-width:2.0;" x1="442" x2="460" y1="1690.3516" y2="1708.3516"/><line style="stroke:#A80036;stroke-width:2.0;" x1="442" x2="460" y1="1708.3516" y2="1690.3516"/><!--MD5=[b0d2b2858fbb84c3b269aabe40dc766a]
@startuml stream_sequence

queue       "Pipe (in)"  as pipe_in
participant Source       as source
participant Sink         as sink
queue       "Pipe (out)" as pipe_out

activate source
activate sink
loop Pipe (in/out) not closed
    |||
    source -> pipe_in ++ : read()
    sink -> sink ++ : recv()
    pipe_in - -> source - - : non-empty data
    source ->> sink : send(SourecAction::Data)
    source -> source ++ : recv()

    sink - -> sink - - : SourceAction::Data
    sink -> pipe_out ++ : write_all()
    return Ok(())
    sink ->> source : send(SinkAction::Ack)
    sink -> pipe_out ++ : flush()
    return Ok(())
    source - -> source - - : SinkAction::Ack
    |||
end

alt Pipe (in) closed
    |||
    source -> pipe_in ++ : read()
    sink -> sink ++ : recv()
    pipe_in - -> source - - : empty data\n(pipe closed)
    source ->> sink : send(SourceAction::SourceClosed)

    sink - -> sink - - : SourceAction::SourceClosed
    sink -> pipe_out ++ : shutdown()
    return Ok(())
    |||
else Read after Pipe (out) closed
    |||
    source -> pipe_in ++ : read()
    sink -> sink ++ : recv()
    pipe_in - -> source - - : non-empty data
    source ->> sink : send(SourecAction::Data)
    source -> source ++ : recv()

    sink - -> sink - - : SourceAction::Data
    sink -> pipe_out ++ : write_all()
    return Err(BrokenPipe)
    sink ->> source : SinkAction::SinkClosed
    sink -> sink ++ : recv()
    source - -> source - - : SinkAction::SinkClosed
    source ->> sink : SourceAction::SourceClosed
    sink - -> sink - - : SourceAction::SourceClosed
    |||
else Pipe (out) closed, but no read operation occurred
    |||
    source -> source ++ : recv()
    sink -> sink ++  : recv()
    [->> source : SinkAction::SinkClosed
    source - -> source - - : SinkAction::SinkClosed
    source ->> sink : SourceAction::SourceClosed
    sink - -> sink - - : SourceAction::SourceClosed
    |||
end
destroy source
destroy sink

@enduml

PlantUML version 1.2021.4(Sun Apr 04 08:49:39 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>